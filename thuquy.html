<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω Th·ªß Qu·ªπ</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="data.js"></script>
    <script src="config.js"></script>
    <script>
        // Expose c√°c bi·∫øn t·ª´ config.js cho c√°c script kh√°c
        if (typeof THUQUY_SHEET_URL !== 'undefined') {
            window.THUQUY_SHEET_URL = THUQUY_SHEET_URL;
        }
        if (typeof THUQUY_SHEET_EXPORT_URL !== 'undefined') {
            window.THUQUY_SHEET_EXPORT_URL = THUQUY_SHEET_EXPORT_URL;
        }
        if (typeof THUQUY_SHEET_HTML_URL !== 'undefined') {
            window.THUQUY_SHEET_HTML_URL = THUQUY_SHEET_HTML_URL;
        }
    </script>
    <script src="js/thuquy-data.js"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: #ffffff;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            border: none;
        }

        h1 {
            font-size: 2.2em;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            margin: 0 0 20px 0;
            letter-spacing: 0.5px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h2 {
            font-size: 1.5em;
            text-align: center;
            color: #667eea;
            font-weight: 600;
            margin: 0 0 25px 0;
        }

        .back-home {
            text-align: center;
            margin-bottom: 15px;
        }

        .back-home a {
            display: inline-block;
            padding: 10px 16px;
            border-radius: 8px;
            background: linear-gradient(45deg, #4a90e2, #357abd);
            color: #fff;
            text-decoration: none;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .back-home a:hover {
            transform: translateY(-1px);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 1em;
            color: #d81b60;
            font-weight: 500;
            text-align: center;
            margin-bottom: 8px;
            letter-spacing: 0.3px;
        }

        input {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            box-sizing: border-box;
            font-size: 1em;
            background: #fafafa;
            transition: all 0.3s ease;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
            background: #ffffff;
            box-shadow: 0 0 12px rgba(102, 126, 234, 0.3);
            transform: translateY(-2px);
        }

        /* M√†u s·∫Øc cho c√°c √¥ thu (xanh l√°) */
        .income-group input {
            border-color: #4caf50;
            background: linear-gradient(to right, #f1f8f4, #ffffff);
        }

        .income-group input:focus {
            border-color: #2e7d32;
            box-shadow: 0 0 12px rgba(76, 175, 80, 0.4);
            background: #ffffff;
        }

        .income-group label {
            color: #2e7d32;
            font-weight: 600;
        }

        /* M√†u s·∫Øc cho c√°c √¥ chi (ƒë·ªè/cam) */
        .expense-group input {
            border-color: #ff7043;
            background: linear-gradient(to right, #fff5f2, #ffffff);
        }

        .expense-group input:focus {
            border-color: #e64a19;
            box-shadow: 0 0 12px rgba(255, 112, 67, 0.4);
            background: #ffffff;
        }

        .expense-group label {
            color: #e64a19;
            font-weight: 600;
        }

        /* M√†u s·∫Øc cho c√°c √¥ th√¥ng tin kh√°c (xanh d∆∞∆°ng) */
        .info-group input {
            border-color: #42a5f5;
            background: linear-gradient(to right, #f0f8ff, #ffffff);
        }

        .info-group input:focus {
            border-color: #1976d2;
            box-shadow: 0 0 12px rgba(66, 165, 245, 0.4);
            background: #ffffff;
        }

        .info-group label {
            color: #1976d2;
            font-weight: 600;
        }

        button[type="submit"] {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        button[type="submit"]:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }

        button[type="submit"]:active {
            transform: translateY(-1px);
        }

        button[type="submit"]:disabled {
            background: #b0bec5;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        #week_date_range {
            font-size: 0.95em;
            color: #37474f;
            text-align: center;
            margin-top: 8px;
            display: block;
            font-style: italic;
        }

        .action-group {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-bottom: 20px;
        }

        .action-group label {
            display: inline-flex;
            align-items: center;
            font-size: 1em;
            color: #2e7d32;
            font-weight: 500;
            cursor: pointer;
        }

        .action-group input {
            width: auto;
            margin-right: 8px;
        }

        .error-message {
            color: #d32f2f;
            text-align: center;
            margin-top: 10px;
            font-size: 1em;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: #ffffff;
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .modal-content h3 {
            margin: 0 0 15px;
            color: #1a237e;
            font-size: 1.4em;
        }

        .modal-content p {
            margin: 5px 0;
            font-size: 1em;
            color: #37474f;
        }

        .modal-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .modal-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-buttons .copy-btn {
            background: #2e7d32;
            color: #ffffff;
        }

        .modal-buttons .copy-btn:hover {
            background: #1b5e20;
        }

        .modal-buttons .close-btn {
            background: #d81b60;
            color: #ffffff;
        }

        .modal-buttons .close-btn:hover {
            background: #b71c1c;
        }

        .paired-group {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .paired-group .form-subgroup {
            flex: 1;
        }

        .paired-group .form-subgroup label {
            text-align: left;
            margin-bottom: 5px;
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.6em;
            }

            h2 {
                font-size: 1.3em;
            }

            input,
            button[type="submit"] {
                font-size: 0.95em;
                padding: 10px;
            }

            .action-group {
                gap: 15px;
            }

            label {
                font-size: 0.95em;
            }

            .modal-content {
                width: 95%;
                padding: 15px;
            }

            .modal-content h3 {
                font-size: 1.2em;
            }

            .modal-content p {
                font-size: 0.9em;
            }

            .modal-buttons button {
                padding: 8px 15px;
                font-size: 0.9em;
            }

            /* Mobile: ·∫®n text tr√™n n√∫t tu·∫ßn, ch·ªâ hi·ªán icon */
            #prevWeekBtn {
                padding: 12px 15px !important;
                min-width: 50px;
                font-size: 0 !important;
                position: relative;
            }

            #prevWeekBtn::before {
                content: '‚óÄ';
                font-size: 20px !important;
                display: inline-block;
                line-height: 1;
            }

            #nextWeekBtn {
                padding: 12px 15px !important;
                min-width: 50px;
                font-size: 0 !important;
                position: relative;
            }

            #nextWeekBtn::after {
                content: '‚ñ∂';
                font-size: 20px !important;
                display: inline-block;
                line-height: 1;
            }

            /* ƒê·∫£m b·∫£o √¥ input tu·∫ßn c√≥ ƒë·ªß kh√¥ng gian tr√™n mobile */
            #week {
                min-width: 80px !important;
                font-size: 1em !important;
                flex: 1 1 auto;
            }

            /* ƒê·∫£m b·∫£o container tu·∫ßn kh√¥ng b·ªã wrap */
            .form-group > div[style*="display: flex"] {
                flex-wrap: nowrap !important;
            }

            .paired-group {
                flex-direction: column;
                gap: 20px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="back-home">
            <a href="index.html">‚Üê Tr·ªü v·ªÅ trang ch·ªß</a>
        </div>
        <h1>D√ÄNH CHO TH·ª¶ QU·ª∏</h1>
        <h2>Qu·∫£n l√Ω thu chi</h2>
        <form id="teamForm"
            action=""
            method="POST">
            <input type="hidden" name="team" value="ThuQuy">
            <div class="form-group action-group">
                <label><input type="radio" name="action" value="add" checked> B√°o c√°o m·ªõi (Tu·∫ßn m·ªõi)</label>
                <label><input type="radio" name="action" value="append"> B·ªï sung (ƒê√≥ng b·ªï sung, chi b·ªï sung)</label>
                <label><input type="radio" name="action" value="edit"> Ch·ªânh s·ª≠a (Ch·ªâ s·ª≠ d·ª•ng khi nh·∫≠p sai)</label>
            </div>
            <div class="form-group" style="background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); padding: 20px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #9c27b0;">
                <label for="week" style="color: #7b1fa2; font-size: 1.1em; font-weight: 700;">üìÖ TU·∫¶N TH·ª® (PH·∫¢I NH·∫¨P CH√çNH X√ÅC)</label>
                <div style="display: flex; gap: 10px; align-items: center; margin-top: 10px; flex-wrap: nowrap;">
                    <button type="button" id="prevWeekBtn" onclick="viewPreviousWeek()" style="padding: 12px 20px; background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; box-shadow: 0 4px 10px rgba(46, 125, 50, 0.3); transition: all 0.3s; white-space: nowrap; flex-shrink: 0;">‚óÄ Tu·∫ßn tr∆∞·ªõc</button>
                    <input type="number" id="week" name="week" min="1" max="35" required oninput="updateWeekDateRange(); loadWeekDataDisplay();" style="flex: 1; min-width: 80px; border: 2px solid #9c27b0; background: white; font-weight: 600; font-size: 1.1em; text-align: center;">
                    <button type="button" id="nextWeekBtn" onclick="viewNextWeek()" style="padding: 12px 20px; background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; box-shadow: 0 4px 10px rgba(25, 118, 210, 0.3); transition: all 0.3s; white-space: nowrap; flex-shrink: 0;">Tu·∫ßn sau ‚ñ∂</button>
                </div>
                <div id="week_date_range" style="text-align: center; margin-top: 10px; color: #7b1fa2; font-weight: 600; font-size: 1.05em;"></div>
                <input type="hidden" id="week_date_range_input" name="week_date_range">
            </div>
            <div id="weekDataDisplay" style="margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; display: none; box-shadow: 0 4px 15px rgba(0,0,0,0.2); color: white;">
                <h3 style="margin: 0 0 15px 0; color: white; font-size: 1.3em; text-align: center; border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 10px;">
                    üìä K·∫æT QU·∫¢ QU·ª∏ L·ªöP - TU·∫¶N <span id="displayWeek"></span>
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 5px;">T·ªïng thu</div>
                        <div style="font-size: 1.5em; font-weight: bold;" id="displayTotalIncome">0</div>
                        <div style="font-size: 0.8em; opacity: 0.8;">VNƒê</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 5px;">T·ªïng chi</div>
                        <div style="font-size: 1.5em; font-weight: bold;" id="displayTotalExpense">0</div>
                        <div style="font-size: 0.8em; opacity: 0.8;">VNƒê</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.3); padding: 15px; border-radius: 8px; text-align: center; grid-column: 1 / -1;">
                        <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 5px;">üí∞ S·ªë ti·ªÅn c√≤n l·∫°i</div>
                        <div style="font-size: 2em; font-weight: bold;" id="displayTotalRemaining">0</div>
                        <div style="font-size: 0.8em; opacity: 0.8;">VNƒê</div>
                    </div>
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid rgba(255,255,255,0.3);">
                    <div style="font-size: 1em;"><strong>üë• H·ªçc sinh thi·∫øu:</strong> <span id="displayMissingStudents" style="font-weight: normal;">-</span></div>
                </div>
            </div>
            <!-- Ph·∫ßn THU - M√†u xanh l√° -->
            <div style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); padding: 20px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #4caf50;">
                <h3 style="margin: 0 0 15px 0; color: #2e7d32; font-size: 1.3em; text-align: center; font-weight: 700;">
                    üí∞ PH·∫¶N THU
                </h3>
                <div class="form-group paired-group income-group">
                    <div class="form-subgroup">
                        <label for="fee_per_student">1. Ti·ªÅn Thu (1 HS/1 Tu·∫ßn):</label>
                        <input type="number" id="fee_per_student" name="fee_per_student" placeholder="V√≠ d·ª•: 9000" step="1"
                            min="0">
                    </div>
                    <div class="form-subgroup">
                        <label for="quantity_paid">2. S·ªë l∆∞·ª£ng (HS n·ªôp):</label>
                        <input type="number" id="quantity_paid" name="quantity_paid" placeholder="V√≠ d·ª•: 45" min="0">
                    </div>
                </div>
            </div>

            <!-- Ph·∫ßn TH√îNG TIN - M√†u xanh d∆∞∆°ng -->
            <div style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); padding: 20px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #42a5f5;">
                <h3 style="margin: 0 0 15px 0; color: #1976d2; font-size: 1.3em; text-align: center; font-weight: 700;">
                    üìã TH√îNG TIN H·ªåC SINH
                </h3>
                <div class="form-group paired-group info-group">
                    <div class="form-subgroup">
                        <label for="missing_students">3. T√™n HS thi·∫øu:</label>
                        <input type="text" id="missing_students" name="missing_students" placeholder="V√≠ d·ª•: Phong, Ng√¢n">
                    </div>
                    <div class="form-subgroup">
                        <label for="quantity_missing">4. S·ªë l∆∞·ª£ng (HS thi·∫øu):</label>
                        <input type="number" id="quantity_missing" name="quantity_missing" placeholder="V√≠ d·ª•: 2" min="0">
                    </div>
                </div>
            </div>

            <!-- Ph·∫ßn CHI - M√†u ƒë·ªè/cam -->
            <div style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); padding: 20px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #ff7043;">
                <h3 style="margin: 0 0 15px 0; color: #e64a19; font-size: 1.3em; text-align: center; font-weight: 700;">
                    üí∏ PH·∫¶N CHI
                </h3>
                <div class="form-group paired-group expense-group">
                    <div class="form-subgroup">
                        <label for="expense_name_1">5. T√™n Ti·ªÅn chi 1:</label>
                        <input type="text" id="expense_name_1" name="expense_name_1" placeholder="V√≠ d·ª•: Mua hoa">
                    </div>
                    <div class="form-subgroup">
                        <label for="expense_amount_1">S·ªë Ti·ªÅn (chi 1):</label>
                        <input type="number" id="expense_amount_1" name="expense_amount_1" placeholder="V√≠ d·ª•: 50000"
                            step="1" min="0">
                    </div>
                </div>
                <div class="form-group paired-group expense-group">
                    <div class="form-subgroup">
                        <label for="expense_name_2">6. T√™n Ti·ªÅn chi 2:</label>
                        <input type="text" id="expense_name_2" name="expense_name_2" placeholder="V√≠ d·ª•: In t√†i li·ªáu">
                    </div>
                    <div class="form-subgroup">
                        <label for="expense_amount_2">S·ªë Ti·ªÅn (chi 2):</label>
                        <input type="number" id="expense_amount_2" name="expense_amount_2" placeholder="V√≠ d·ª•: 20000"
                            step="1" min="0">
                    </div>
                </div>
                <div class="form-group paired-group expense-group">
                    <div class="form-subgroup">
                        <label for="expense_name_3">7. T√™n Ti·ªÅn chi 3:</label>
                        <input type="text" id="expense_name_3" name="expense_name_3" placeholder="V√≠ d·ª•: Mua d·ª•ng c·ª•">
                    </div>
                    <div class="form-subgroup">
                        <label for="expense_amount_3">S·ªë Ti·ªÅn (chi 3):</label>
                        <input type="number" id="expense_amount_3" name="expense_amount_3" placeholder="V√≠ d·ª•: 30000"
                            step="1" min="0">
                    </div>
                </div>
                <div class="form-group paired-group expense-group">
                    <div class="form-subgroup">
                        <label for="expense_name_4">8. T√™n Ti·ªÅn chi 4:</label>
                        <input type="text" id="expense_name_4" name="expense_name_4" placeholder="V√≠ d·ª•: Mua qu√†">
                    </div>
                    <div class="form-subgroup">
                        <label for="expense_amount_4">S·ªë Ti·ªÅn (chi 4):</label>
                        <input type="number" id="expense_amount_4" name="expense_amount_4" placeholder="V√≠ d·ª•: 40000"
                            step="1" min="0">
                    </div>
                </div>
                <div class="form-group paired-group expense-group">
                    <div class="form-subgroup">
                        <label for="expense_name_5">9. T√™n Ti·ªÅn chi 5:</label>
                        <input type="text" id="expense_name_5" name="expense_name_5" placeholder="V√≠ d·ª•: Photo th√™m">
                    </div>
                    <div class="form-subgroup">
                        <label for="expense_amount_5">S·ªë Ti·ªÅn (chi 5):</label>
                        <input type="number" id="expense_amount_5" name="expense_amount_5" placeholder="V√≠ d·ª•: 50000"
                            step="1" min="0">
                    </div>
                </div>
                <div class="form-group paired-group expense-group">
                    <div class="form-subgroup">
                        <label for="expense_name_6">10. T√™n Ti·ªÅn chi 6:</label>
                        <input type="text" id="expense_name_6" name="expense_name_6" placeholder="V√≠ d·ª•: Kh√°c">
                    </div>
                    <div class="form-subgroup">
                        <label for="expense_amount_6">S·ªë Ti·ªÅn (chi 6):</label>
                        <input type="number" id="expense_amount_6" name="expense_amount_6" placeholder="V√≠ d·ª•: 60000"
                            step="1" min="0">
                    </div>
                </div>
            </div>
            <div class="form-group" style="background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%); padding: 20px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #fbc02d;">
                <label for="password" style="color: #f57f17; font-size: 1.1em; font-weight: 700;">üîí M·∫¨T KH·∫®U (Th·∫ßy c·∫•p ri√™ng cho Th·ªß qu·ªπ)</label>
                <input type="password" id="password" name="password" required style="border: 2px solid #fbc02d; background: white; font-weight: 600; margin-top: 10px;">
            </div>
            <button type="submit" id="submitButton" style="margin-top: 10px;">üì§ G·ª¨I D·ªÆ LI·ªÜU</button>
        </form>
    </div>
    <div class="modal" id="summaryModal">
        <div class="modal-content">
            <h3>K·∫øt qu·∫£ thu chi</h3>
            <div id="summaryContent"></div>
            <div class="modal-buttons">
                <button class="copy-btn" onclick="copySummary()">Sao ch√©p</button>
                <button class="close-btn" onclick="closeModal()">ƒê√≥ng</button>
            </div>
        </div>
    </div>
    <script>
        // S·ª≠ d·ª•ng SCHOOL_WEEKS_CONFIG t·ª´ data.js (ƒë√£ load tr∆∞·ªõc ƒë√≥)
        // Helper function ƒë·ªÉ l·∫•y week range string
        function getWeekRangeString(weekNumber) {
            if (typeof SCHOOL_WEEKS_CONFIG === 'undefined' || !SCHOOL_WEEKS_CONFIG) {
                return '';
            }
            if (weekNumber < 1 || weekNumber > SCHOOL_WEEKS_CONFIG.length) {
                return '';
            }
            const weekConfig = SCHOOL_WEEKS_CONFIG[weekNumber - 1];
            if (!weekConfig) return '';
            return `t·ª´ ng√†y ${weekConfig.from} ƒë·∫øn ${weekConfig.to}`;
        }

        // T√≠nh tu·∫ßn hi·ªán t·∫°i d·ª±a tr√™n ng√†y th√°ng (s·ª≠ d·ª•ng SCHOOL_WEEKS_CONFIG t·ª´ data.js)
        function getCurrentWeek() {
            // S·ª≠ d·ª•ng h√†m t·ª´ data.js n·∫øu c√≥
            if (typeof getCurrentWeekNumber === 'function' && typeof SCHOOL_WEEKS_CONFIG !== 'undefined') {
                const week = getCurrentWeekNumber();
                console.log('getCurrentWeekNumber() returned:', week);
                return week;
            }
            
            // Fallback: t·ª± t√≠nh t·ª´ SCHOOL_WEEKS_CONFIG
            if (typeof SCHOOL_WEEKS_CONFIG === 'undefined' || !SCHOOL_WEEKS_CONFIG || SCHOOL_WEEKS_CONFIG.length === 0) {
                console.warn('SCHOOL_WEEKS_CONFIG ch∆∞a ƒë∆∞·ª£c load t·ª´ data.js, tr·∫£ v·ªÅ tu·∫ßn 1');
                return 1;
            }
            
            const today = new Date();
            // Normalize to midnight local time ƒë·ªÉ tr√°nh l·ªói timezone
            const currentDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            currentDate.setHours(0, 0, 0, 0);
            console.log('Current date:', currentDate);
            
            // T√¨m tu·∫ßn ch·ª©a ng√†y hi·ªán t·∫°i
            for (let i = 0; i < SCHOOL_WEEKS_CONFIG.length; i++) {
                const weekConfig = SCHOOL_WEEKS_CONFIG[i];
                if (!weekConfig || !weekConfig.from || !weekConfig.to) continue;
                
                const [fromDay, fromMonth, fromYear] = weekConfig.from.split('/').map(Number);
                const [toDay, toMonth, toYear] = weekConfig.to.split('/').map(Number);
                
                // Ki·ªÉm tra d·ªØ li·ªáu h·ª£p l·ªá
                if (isNaN(fromDay) || isNaN(fromMonth) || isNaN(fromYear) || 
                    isNaN(toDay) || isNaN(toMonth) || isNaN(toYear)) {
                    continue;
                }
                
                const startDate = new Date(fromYear, fromMonth - 1, fromDay);
                startDate.setHours(0, 0, 0, 0);
                const endDate = new Date(toYear, toMonth - 1, toDay);
                endDate.setHours(23, 59, 59, 999); // Bao g·ªìm c·∫£ ng√†y cu·ªëi
                
                if (currentDate >= startDate && currentDate <= endDate) {
                    console.log('Found current week:', weekConfig.week, 'from', weekConfig.from, 'to', weekConfig.to);
                    return weekConfig.week;
                }
            }
            
            // N·∫øu kh√¥ng t√¨m th·∫•y tu·∫ßn ch·ª©a ng√†y hi·ªán t·∫°i, t√¨m tu·∫ßn g·∫ßn nh·∫•t trong qu√° kh·ª©
            // (V√¨ Ch·ªß nh·∫≠t kh√¥ng ƒë∆∞·ª£c li·ªát k√™ trong tu·∫ßn h·ªçc, n√™n n·∫øu h√¥m nay l√† Ch·ªß nh·∫≠t
            // ho·∫∑c n·∫±m gi·ªØa c√°c tu·∫ßn, ta s·∫Ω tr·∫£ v·ªÅ tu·∫ßn v·ª´a qua)
            for (let i = SCHOOL_WEEKS_CONFIG.length - 1; i >= 0; i--) {
                const weekConfig = SCHOOL_WEEKS_CONFIG[i];
                if (!weekConfig || !weekConfig.from) continue;
                
                const [fromDay, fromMonth, fromYear] = weekConfig.from.split('/').map(Number);
                if (isNaN(fromDay) || isNaN(fromMonth) || isNaN(fromYear)) continue;
                
                const startDate = new Date(fromYear, fromMonth - 1, fromDay);
                startDate.setHours(0, 0, 0, 0);
                
                // N·∫øu tu·∫ßn n√†y b·∫Øt ƒë·∫ßu tr∆∞·ªõc ho·∫∑c b·∫±ng ng√†y hi·ªán t·∫°i, ƒë√¢y l√† tu·∫ßn g·∫ßn nh·∫•t trong qu√° kh·ª©
                if (startDate <= currentDate) {
                    console.log('Found nearest past week:', weekConfig.week, 'from', weekConfig.from);
                    return weekConfig.week;
                }
            }
            
            console.log('No week found, returning week 1');
            return 1; // M·∫∑c ƒë·ªãnh tu·∫ßn 1
        }

        function updateWeekDateRange() {
            const weekInput = document.getElementById('week');
            if (!weekInput) {
                console.warn('week input not found');
                return;
            }
            
            const weekValue = parseInt(weekInput.value) || 0;
            const weekDateRange = document.getElementById('week_date_range');
            const weekDateRangeInput = document.getElementById('week_date_range_input');
            
            if (!weekDateRange || !weekDateRangeInput) {
                console.warn('week_date_range elements not found');
                return;
            }
            
            if (weekValue >= 1 && weekValue <= 35) {
                const rangeString = getWeekRangeString(weekValue);
                if (rangeString) {
                    weekDateRange.textContent = rangeString;
                    weekDateRangeInput.value = rangeString;
                    console.log('Updated week date range for week', weekValue, ':', rangeString);
                } else {
                    // N·∫øu ch∆∞a load ƒë∆∞·ª£c SCHOOL_WEEKS_CONFIG, th·ª≠ l·∫°i sau
                    if (typeof SCHOOL_WEEKS_CONFIG === 'undefined') {
                        console.warn('SCHOOL_WEEKS_CONFIG ch∆∞a ƒë∆∞·ª£c load, s·∫Ω th·ª≠ l·∫°i sau 200ms');
                        setTimeout(updateWeekDateRange, 200);
                    } else {
                        weekDateRange.textContent = 'Kh√¥ng t√¨m th·∫•y th√¥ng tin tu·∫ßn ' + weekValue;
                        weekDateRangeInput.value = '';
                    }
                }
            } else {
                weekDateRange.textContent = '';
                weekDateRangeInput.value = '';
            }
        }

        // ƒê·ªçc d·ªØ li·ªáu t·ª´ Google Sheet CSV
        async function loadDataFromSheetCSV() {
            try {
                // ‚ö†Ô∏è PH·∫¢I L·∫§Y T·ª™ config.js - KH√îNG D√ôNG HARDCODE
                // L·∫•y t·ª´ config.js - t·ª± ƒë·ªông t√≠nh t·ª´ c√°c gi√° tr·ªã c∆° b·∫£n
                const sheetId = typeof SPREADSHEET_ID !== 'undefined' ? SPREADSHEET_ID : '';
                const gid = typeof THUQUY_SHEET_GID !== 'undefined' ? THUQUY_SHEET_GID : '';
                
                // S·ª≠ d·ª•ng THUQUY_SHEET_URL v√† THUQUY_SHEET_EXPORT_URL t·ª´ config.js
                const primaryCsvUrl = typeof THUQUY_SHEET_URL !== 'undefined' ? THUQUY_SHEET_URL : '';
                const exportCsvUrl = typeof THUQUY_SHEET_EXPORT_URL !== 'undefined' ? THUQUY_SHEET_EXPORT_URL : '';
                
                // Th·ª≠ c√°c URL CSV export kh√°c nhau (t·∫•t c·∫£ ƒë·ªÅu l·∫•y t·ª´ config.js)
                const csvUrls = [];
                
                // ∆Øu ti√™n 1: THUQUY_SHEET_URL (published CSV URL)
                if (primaryCsvUrl) {
                    csvUrls.push(primaryCsvUrl);
                }
                
                // ∆Øu ti√™n 2: THUQUY_SHEET_EXPORT_URL (export CSV URL)
                if (exportCsvUrl) {
                    csvUrls.push(exportCsvUrl);
                }
                
                // Fallback: T√≠nh t·ª´ SPREADSHEET_ID v√† THUQUY_SHEET_GID (n·∫øu c√≥)
                if (sheetId && gid) {
                    csvUrls.push(`https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&gid=${gid}`);
                    csvUrls.push(`https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&gid=${gid}`);
                }
                
                if (csvUrls.length === 0) {
                    throw new Error('Kh√¥ng t√¨m th·∫•y URL CSV t·ª´ config.js. Vui l√≤ng ki·ªÉm tra THUQUY_SHEET_URL, THUQUY_SHEET_EXPORT_URL, SPREADSHEET_ID v√† THUQUY_SHEET_GID trong config.js');
                }
                
                for (let csvUrl of csvUrls) {
                    try {
                        console.log('Trying CSV URL:', csvUrl);
                        
                        // Th·ª≠ v·ªõi cors mode
                        const response = await fetch(csvUrl, {
                            method: 'GET',
                            mode: 'cors',
                            cache: 'no-cache',
                            headers: {
                                'Accept': 'text/csv'
                            }
                        });
                        
                        if (response.ok) {
                            const csvText = await response.text();
                            console.log('CSV loaded successfully, length:', csvText.length);
                            
                            if (csvText && csvText.length > 0) {
                                console.log('CSV first 500 chars:', csvText.substring(0, 500));
                                const parsedData = parseCSV(csvText);
                                console.log('Parsed CSV rows:', parsedData.length);
                                
                                if (parsedData.length > 0) {
                                    console.log('First row:', parsedData[0]);
                                    console.log('First row columns:', parsedData[0] ? parsedData[0].length : 0);
                                    if (parsedData.length > 1) {
                                        console.log('Second row:', parsedData[1]);
                                    }
                                    return parsedData;
                                }
                            }
                        } else {
                            console.log('Response not OK:', response.status, response.statusText);
                        }
                    } catch (urlError) {
                        console.log('Failed with URL:', csvUrl, urlError.message);
                        continue; // Th·ª≠ URL ti·∫øp theo
                    }
                }
                
                // N·∫øu t·∫•t c·∫£ ƒë·ªÅu fail, th·ª≠ d√πng proxy service
                console.log('All direct URLs failed, trying proxy...');
                const proxyUrls = [
                    `https://api.allorigins.win/get?url=${encodeURIComponent(csvUrls[0])}`,
                    `https://corsproxy.io/?${encodeURIComponent(csvUrls[0])}`
                ];
                
                for (let proxyUrl of proxyUrls) {
                    try {
                        const proxyResponse = await fetch(proxyUrl);
                        if (proxyResponse.ok) {
                            const proxyData = await proxyResponse.json();
                            if (proxyData.contents) {
                                const parsedData = parseCSV(proxyData.contents);
                                console.log('CSV loaded via proxy, rows:', parsedData.length);
                                if (parsedData.length > 0) {
                                    return parsedData;
                                }
                            }
                        }
                    } catch (proxyError) {
                        console.log('Proxy failed:', proxyUrl, proxyError.message);
                        continue;
                    }
                }
                
                // Th·ª≠ ƒë·ªçc t·ª´ HTML table n·∫øu sheet ƒë∆∞·ª£c publish
                console.log('Trying to read from published HTML...');
                try {
                    // ‚ö†Ô∏è PH·∫¢I L·∫§Y T·ª™ config.js
                    const htmlUrl = typeof THUQUY_SHEET_HTML_URL !== 'undefined' 
                        ? THUQUY_SHEET_HTML_URL 
                        : (typeof PUBLISHED_SPREADSHEET_URL !== 'undefined' && gid
                            ? `${PUBLISHED_SPREADSHEET_URL}/pubhtml?gid=${gid}&single=true`
                            : '');
                    
                    if (htmlUrl) {
                        const htmlResponse = await fetch(htmlUrl, { mode: 'no-cors' });
                        // V·ªõi no-cors, kh√¥ng th·ªÉ ƒë·ªçc response, c·∫ßn c√°ch kh√°c
                    } else {
                        console.warn('THUQUY_SHEET_HTML_URL kh√¥ng ƒë∆∞·ª£c t√¨m th·∫•y trong config.js');
                    }
                } catch (htmlError) {
                    console.log('HTML read failed:', htmlError);
                }
                
                return null;
            } catch (error) {
                console.error('Error loading CSV:', error);
                console.error('Error details:', error.message);
                return null;
            }
        }

        // Parse CSV text th√†nh m·∫£ng d·ªØ li·ªáu
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const data = [];
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                // Parse CSV line (x·ª≠ l√Ω c√°c tr∆∞·ªùng h·ª£p c√≥ d·∫•u ph·∫©y trong gi√° tr·ªã)
                const values = [];
                let current = '';
                let inQuotes = false;
                
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        values.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                values.push(current.trim());
                
                data.push(values);
            }
            
            return data;
        }

        // T√¨m d·ªØ li·ªáu theo tu·∫ßn t·ª´ CSV data
        function findWeekDataFromCSV(csvData, week) {
            if (!csvData || csvData.length < 2) {
                console.log('CSV data is empty or invalid');
                return null;
            }
            
            const weekStr = String(week);
            console.log('Looking for week:', weekStr);
            console.log('Total CSV rows:', csvData.length);
            
            // T√¨m d√≤ng c√≥ tu·∫ßn kh·ªõp (c·ªôt A l√† index 0)
            for (let i = 1; i < csvData.length; i++) {
                const row = csvData[i];
                if (!row || row.length === 0) continue;
                
                const weekValue = row[0] ? String(row[0]).trim() : '';
                console.log(`Row ${i}, week value:`, weekValue, 'columns:', row.length);
                
                if (weekValue === weekStr) {
                    console.log('Found matching week at row:', i);
                    console.log('Row data:', row);
                    
                    // C·ªôt mapping: A=0, E=4, S=18, T=19, U=20
                    // C·ªôt E (index 4): T√™n HS thi·∫øu
                    // C·ªôt S (index 18): T·ªïng thu
                    // C·ªôt T (index 19): T·ªïng chi
                    // C·ªôt U (index 20): C√≤n l·∫°i
                    const missingStudents = row[4] ? String(row[4]).trim() : '';
                    const totalIncomeRaw = row[18] ? String(row[18]).trim() : '';
                    const totalExpenseRaw = row[19] ? String(row[19]).trim() : '';
                    const totalRemainingRaw = row[20] ? String(row[20]).trim() : '';
                    
                    // Parse s·ªë, lo·∫°i b·ªè c√°c k√Ω t·ª± kh√¥ng ph·∫£i s·ªë (tr·ª´ d·∫•u - v√† .)
                    const totalIncome = totalIncomeRaw ? parseFloat(totalIncomeRaw.replace(/[^\d.-]/g, '')) || 0 : 0;
                    const totalExpense = totalExpenseRaw ? parseFloat(totalExpenseRaw.replace(/[^\d.-]/g, '')) || 0 : 0;
                    const totalRemaining = totalRemainingRaw ? parseFloat(totalRemainingRaw.replace(/[^\d.-]/g, '')) || 0 : 0;
                    
                    console.log('Parsed values:', {
                        missingStudents,
                        totalIncomeRaw,
                        totalIncome,
                        totalExpenseRaw,
                        totalExpense,
                        totalRemainingRaw,
                        totalRemaining
                    });
                    
                    return {
                        week: weekValue || week,
                        missing_students: missingStudents,
                        total_income: totalIncome,
                        total_expense: totalExpense,
                        total_remaining: totalRemaining
                    };
                }
            }
            
            console.log('Week not found in CSV data');
            return null;
        }

        async function loadWeekDataDisplay() {
            const week = document.getElementById('week').value;
            if (!week || week < 1 || week > 35) {
                document.getElementById('weekDataDisplay').style.display = 'none';
                return;
            }

            // Hi·ªÉn th·ªã loading
            const displayDiv = document.getElementById('weekDataDisplay');
            displayDiv.style.display = 'block';
            document.getElementById('displayWeek').textContent = week;
            document.getElementById('displayTotalIncome').textContent = 'ƒêang t·∫£i...';
            document.getElementById('displayTotalExpense').textContent = 'ƒêang t·∫£i...';
            document.getElementById('displayTotalRemaining').textContent = 'ƒêang t·∫£i...';
            document.getElementById('displayMissingStudents').textContent = 'ƒêang t·∫£i...';

            try {
                // S·ª≠ d·ª•ng h√†m t·ª´ js/thuquy-data.js ƒë·ªÉ ƒë·ªçc d·ªØ li·ªáu
                console.log('Loading week data for week:', week);
                
                // Ki·ªÉm tra h√†m t·ª´ file JS c√≥ t·ªìn t·∫°i kh√¥ng
                // ƒê·ª£i m·ªôt ch√∫t n·∫øu h√†m ch∆∞a load
                let loadDataFunc = window.loadWeekData || (typeof loadWeekData !== 'undefined' ? loadWeekData : null);
                
                if (!loadDataFunc) {
                    // Th·ª≠ ƒë·ª£i th√™m m·ªôt ch√∫t ƒë·ªÉ script load xong
                    await new Promise(resolve => setTimeout(resolve, 200));
                    loadDataFunc = window.loadWeekData || (typeof loadWeekData !== 'undefined' ? loadWeekData : null);
                }
                
                if (!loadDataFunc) {
                    throw new Error('H√†m loadWeekData kh√¥ng t·ªìn t·∫°i. Vui l√≤ng ki·ªÉm tra file js/thuquy-data.js ƒë√£ ƒë∆∞·ª£c load ch∆∞a. ƒê·∫£m b·∫£o th·ª© t·ª±: data.js -> config.js -> js/thuquy-data.js');
                }
                
                // S·ª≠ d·ª•ng h√†m t·ª´ file js/thuquy-data.js
                const weekData = await loadDataFunc(week);
                
                if (!weekData) {
                    throw new Error('Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu cho tu·∫ßn ' + week);
                }
                
                console.log('‚úì Week data found:', weekData);
                document.getElementById('displayWeek').textContent = weekData.week;
                document.getElementById('displayTotalIncome').textContent = formatNumber(weekData.total_income || 0);
                document.getElementById('displayTotalExpense').textContent = formatNumber(weekData.total_expense || 0);
                document.getElementById('displayTotalRemaining').textContent = formatNumber(weekData.total_remaining || 0);
                document.getElementById('displayMissingStudents').textContent = weekData.missing_students || 'Kh√¥ng c√≥';
                
                // ƒê·∫£m b·∫£o m√†u n·ªÅn ƒë√∫ng (kh√¥ng ph·∫£i l·ªói)
                const displayDiv = document.getElementById('weekDataDisplay');
                if (displayDiv) {
                    displayDiv.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                }
            } catch (error) {
                console.error('Error loading week data:', error);
                document.getElementById('displayWeek').textContent = week;
                document.getElementById('displayTotalIncome').textContent = 'L·ªói: ' + error.message;
                document.getElementById('displayTotalExpense').textContent = 'L·ªói: ' + error.message;
                document.getElementById('displayTotalRemaining').textContent = 'L·ªói: ' + error.message;
                document.getElementById('displayMissingStudents').textContent = 'Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu';
                
                // ƒê·ªïi m√†u ƒë·ªÉ b√°o l·ªói
                const displayDiv = document.getElementById('weekDataDisplay');
                if (displayDiv) {
                    displayDiv.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
                }
            }
        }

        function viewPreviousWeek() {
            const currentWeek = parseInt(document.getElementById('week').value) || 1;
            if (currentWeek > 1) {
                document.getElementById('week').value = currentWeek - 1;
                updateWeekDateRange();
                loadWeekDataDisplay();
            } else {
                alert('ƒê√¢y l√† tu·∫ßn ƒë·∫ßu ti√™n!');
            }
        }

        function viewNextWeek() {
            const currentWeek = parseInt(document.getElementById('week').value) || 1;
            const maxWeek = 35; // S·ªë tu·∫ßn t·ªëi ƒëa trong nƒÉm h·ªçc
            if (currentWeek < maxWeek) {
                document.getElementById('week').value = currentWeek + 1;
                updateWeekDateRange();
                loadWeekDataDisplay();
            } else {
                alert('ƒê√¢y l√† tu·∫ßn cu·ªëi c√πng!');
            }
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('vi-VN').format(num);
        }

        function validateForm() {
            const numericFields = [
                'fee_per_student',
                'quantity_paid',
                'quantity_missing',
                'expense_amount_1',
                'expense_amount_2',
                'expense_amount_3',
                'expense_amount_4',
                'expense_amount_5',
                'expense_amount_6'
            ];
            for (let field of numericFields) {
                const input = document.getElementById(field);
                if (input.value === '' || isNaN(input.value)) {
                    input.value = '0';
                }
            }
            return true;
        }

        function showModal(summary, week) {
            const modal = document.getElementById('summaryModal');
            const content = document.getElementById('summaryContent');
            let htmlContent = `<p><strong>Tu·∫ßn ${summary.week || week}:</strong></p>`;
            htmlContent += `<p><strong>T·ªïng thu:</strong> ${formatNumber(summary.total_income || 0)} VNƒê</p>`;
            htmlContent += `<p><strong>T·ªïng chi:</strong> ${formatNumber(summary.total_expense || 0)} VNƒê</p>`;
            htmlContent += `<p><strong>S·ªë ti·ªÅn c√≤n l·∫°i:</strong> ${formatNumber(summary.total_remaining || 0)} VNƒê</p>`;
            htmlContent += `<p><strong>H·ªçc sinh thi·∫øu:</strong> ${summary.missing_students || 'Kh√¥ng c√≥'}</p>`;
            content.innerHTML = htmlContent;
            modal.style.display = 'flex';
        }

        function copySummary() {
            const content = document.getElementById('summaryContent').innerText;
            navigator.clipboard.writeText(content).then(() => {
                alert('ƒê√£ sao ch√©p k·∫øt qu·∫£ thu chi v√†o clipboard!');
            }).catch(err => {
                alert('L·ªói khi sao ch√©p: ' + err.message);
            });
        }

        function closeModal() {
            document.getElementById('summaryModal').style.display = 'none';
            window.location.href = 'thankyou.html';
        }

        async function verifyPassword(input) {
            try {
                const formData = new FormData();
                formData.append('action', 'verify');
                formData.append('password', input);
                formData.append('page', 'thuquy');
                
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    alert('L·ªói k·∫øt n·ªëi. Vui l√≤ng th·ª≠ l·∫°i.');
                    return false;
                }
                
                const text = await response.text();
                let data;
                try {
                    data = JSON.parse(text);
                } catch (e) {
                    console.error('Invalid JSON response:', text);
                    alert('L·ªói x·ª≠ l√Ω d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i.');
                    return false;
                }
                
                if (data && data.success) return true;
                alert(data?.error || data?.message || 'M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!');
                return false;
            } catch (error) {
                console.error('Verify password error:', error);
                alert('Kh√¥ng th·ªÉ x√°c th·ª±c. Vui l√≤ng th·ª≠ l·∫°i.');
                return false;
            }
        }

        document.getElementById('teamForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const password = document.getElementById('password').value.trim();

            if (!validateForm()) {
                alert('Vui l√≤ng ki·ªÉm tra c√°c tr∆∞·ªùng s·ªë v√† th·ª≠ l·∫°i.');
                return;
            }

            const submitButton = document.getElementById('submitButton');
            submitButton.textContent = 'ƒêang x√°c th·ª±c...';
            submitButton.disabled = true;

            const isValid = await verifyPassword(password);
            if (!isValid) {
                submitButton.textContent = 'G·ª≠i D·ªØ Li·ªáu';
                submitButton.disabled = false;
                return;
            }

            submitButton.textContent = 'ƒêang g·ª≠i...';

            const formData = new FormData(this);
            
            // Set form action dynamically from config
            this.action = GOOGLE_SCRIPT_URL;

            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                body: formData,
                redirect: 'follow'
            })
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok: ' + response.status);
                    return response.json();
                })
                .then(data => {
                    if (data.result === 'success') {
                        showModal(data.summary, document.getElementById('week').value);
                        // Reload week data after submission
                        setTimeout(() => {
                            loadWeekDataDisplay();
                        }, 500);
                    } else {
                        alert('C√≥ l·ªói x·∫£y ra khi g·ª≠i d·ªØ li·ªáu: ' + data.message);
                        submitButton.disabled = false;
                        submitButton.textContent = 'G·ª≠i D·ªØ Li·ªáu';
                    }
                })
                .catch(error => {
                    alert('C√≥ l·ªói x·∫£y ra khi g·ª≠i d·ªØ li·ªáu: ' + error.message);
                    submitButton.disabled = false;
                    submitButton.textContent = 'G·ª≠i D·ªØ Li·ªáu';
                });
        });

        // T·ª± ƒë·ªông set tu·∫ßn v√† load d·ªØ li·ªáu khi trang ƒë∆∞·ª£c load
        window.addEventListener('DOMContentLoaded', function() {
            const weekInput = document.getElementById('week');
            if (!weekInput) {
                console.error('week input not found');
                return;
            }
            
            // ƒê·ª£i m·ªôt ch√∫t ƒë·ªÉ ƒë·∫£m b·∫£o data.js ƒë√£ load xong SCHOOL_WEEKS_CONFIG
            setTimeout(function() {
                // T√≠nh tu·∫ßn hi·ªán t·∫°i theo th·ªùi gian th·ª±c
                const currentWeek = getCurrentWeek();
                console.log('Current week calculated on page load:', currentWeek);
                
                // Set gi√° tr·ªã tu·∫ßn hi·ªán t·∫°i
                weekInput.value = currentWeek || 1;
                
                // Update week date range ngay l·∫≠p t·ª©c ƒë·ªÉ hi·ªÉn th·ªã kho·∫£ng ng√†y
                updateWeekDateRange();
                
                // Load d·ªØ li·ªáu tu·∫ßn hi·ªán t·∫°i
                loadWeekDataDisplay();
            }, 100);
        });

        // Load d·ªØ li·ªáu khi thay ƒë·ªïi tu·∫ßn
        const weekInput = document.getElementById('week');
        if (weekInput) {
            weekInput.addEventListener('change', function() {
                updateWeekDateRange();
                loadWeekDataDisplay();
            });
            
            weekInput.addEventListener('input', function() {
                // C·∫≠p nh·∫≠t kho·∫£ng ng√†y ngay khi ng∆∞·ªùi d√πng g√µ
                updateWeekDateRange();
            });
        }
    </script>
</body>

</html>